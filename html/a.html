
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>批量删除</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../src/plugins/layui/dist/css/layui.css" media="all">
    <link rel="stylesheet" href="../src/css/yzg.index.css">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style type="text/css">
        .childrenBody {padding:10px;}
    </style>
</head>
<body class="childrenBody">
<blockquote class="layui-elem-quote news_search">
    <div class="layui-inline">
        <div class="layui-input-inline">
        </div>
    </div>
    <div class="layui-inline">
    </div>
    <div class="layui-inline">
        <a class="layui-btn layui-btn-danger batchDel">批量删除</a>
    </div>
    <div class="layui-inline">
        <div class="layui-form-mid layui-word-aux"></div>
    </div>
</blockquote>
<div class="layui-form list">
    <table id="list" class="layui-table" lay-filter="list">
    </table>
</div>
<script src="../src/plugins/layui/dist/layui.all.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script type="text/javascript">
    layui.use(['table','layer','jquery'], function(){

        var table_data=[{
            "id": "1"
            , "goodsName": "杜甫"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "116"
            , "ip": "192.168.0.1"
            , "logins": "108"
            , "joinTime": "2016-10-14"}, {
            "id": "2"
            , "goodsName": "李白"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "12"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
//                ,"LAY_CHECKED": true
        }, {
            "id": "3"
            , "goodsName": "王勃"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "65"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
        }, {
            "id": "4"
            , "goodsName": "贤心"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "666"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
        }, {
            "id": "5"
            , "goodsName": "贤心"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "86"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
        }, {
            "id": "6"
            , "goodsName": "贤心"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "12"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
        }, {
            "id": "7"
            , "goodsName": "贤心"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "16"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
        }, {
            "id": "8"
            , "goodsName": "贤心"
            , "number": "xianxin@layui.com"
            , "sex": "男"
            , "city": "浙江杭州"
            , "sign": "人生恰似一场修行"
            , "experience": "106"
            , "ip": "192.168.0.8"
            , "logins": "106"
            , "joinTime": "2016-10-14"
        }];

        var table_fields=[[ //设置表头
           {checkbox: true,fixed:true,width:50}
           ,{field: 'id', title: '序号', width: 100}
            , {field: 'goodsName', title: '商品名', width: 100}
            , {field: 'number', title: '申请数量', width: 100}
            , {field: 'sign', title: '收货仓', width: 150}
            , {field: 'sex', title: '申请人', width: 80}
            , {field: 'joinTime', title: '申请时间', width: 100, sort: true}
            , {field: 'ip', title: '备注', width: 100}
            , {
                field: 'logins',
                title: '审核状态',
                width: 100,
                event: 'setlogins',
                style: 'color:red;text-decoration: underline;cursor: pointer;'}
            , {field: 'city', title: '订单状态', width: 100}
        ]];


        var layer = parent.layer === undefined ? layui.layer : parent.layer
                ,$ = layui.jquery
                ,table = layui.table;

//执行渲染
        table.render({
            elem: '#list'
            ,id:'list'
            ,cols: table_fields
            ,loading:false
            ,data:table_data
        });

//监听表格复选框选择
        var checkedArr=[];
        table.on('checkbox(list)', function(obj){
            if (obj.type=='all') return;
            if (obj.checked){
                checkedArr[obj.data.id] = obj.data.LAY_TABLE_INDEX;
            }
            else{
                delete checkedArr[obj.data.id];
            }
        });


//批量删除
        $(".batchDel").click(function(){
            var checkStatus = table.checkStatus('list')
                    ,data = checkStatus.data, tmpArr = [], ids = [];
            if (checkStatus.isAll){
                for (var i=0; i<data.length ; i++){
                    checkedArr[data[i].id]=i;
                    ids.push(data[i].id);
                }
            }
            else{
                for (var i=0; i<data.length ; i++){
                    tmpArr[data[i].id]=checkedArr[data[i].id];
                    ids.push(data[i].id);
                }
                checkedArr = tmpArr;
            }

//没有选中任何一行
            if (checkedArr.length == 0){
                layui.layer.msg('请选择要删除行');
                return;
            }

            layui.layer.confirm('真的删除么', function(index){
                layui.layer.close(index);
//ajax从数据库删除 ids.toString();
                $.each(checkedArr, function(k){
                    console.log("tr[data-index="+checkedArr[k]+"]")
                    $("tr[data-index="+checkedArr[k]+"]").remove();
                    console.log("tr[data-index="+checkedArr[k]+"]")
                });
                layui.layer.msg('删除成功');
            });

        });
    });

</script>
</body>
</html>